import {
  collectionSizeOrDefault36dulx8yinfqm as collectionSizeOrDefault,
  mapCapacity1h45rc3eh9p2l as mapCapacity,
  coerceAtLeast2bkz8m9ik7hep as coerceAtLeast,
  LinkedHashMap_init_$Create$snys8oz8txtu as LinkedHashMap_init_$Create$,
  Unit_instanceat14thlj150z as Unit_instance,
  protoOf180f3jzyo7rfj as protoOf,
  initMetadataForCompanion1wyw17z38v6ac as initMetadataForCompanion,
  enumEntries20mr21zbe3az4 as enumEntries,
  objectCreate1ve4bgxiu4x98 as objectCreate,
  Enum3alwj03lh1n41 as Enum,
  initMetadataForClassbxx6q50dy2s7 as initMetadataForClass,
  VOID7hggqo3abtya as VOID,
  toString1pkumu07cwy4m as toString,
  getStringHashCode26igk1bx568vk as getStringHashCode,
  THROW_CCE2g6jy02ryeudk as THROW_CCE,
  initMetadataForInterface1egvbzx539z91 as initMetadataForInterface,
  Long2qws0ah9gnpki as Long,
  isInterface3d6p8outrmvmk as isInterface,
  IllegalArgumentException_init_$Create$sfel9vrfa7w2 as IllegalArgumentException_init_$Create$,
  CoroutineImpl2sn3kjnwmfr10 as CoroutineImpl,
  get_COROUTINE_SUSPENDED3ujt3p13qm4iy as get_COROUTINE_SUSPENDED,
  ensureNotNull1e947j3ixpazm as ensureNotNull,
  initMetadataForLambda3af3he42mmnh as initMetadataForLambda,
  CancellationException_init_$Create$1eqo789zqov68 as CancellationException_init_$Create$,
  CancellationException3b36o9qz53rgr as CancellationException,
  initMetadataForCoroutine1i7lbatuf5bnt as initMetadataForCoroutine,
  toString30pk9tzaqopn as toString_0,
  toLongw1zpgk99d84b as toLong,
  ArrayList_init_$Create$2rimpp4x9tjd3 as ArrayList_init_$Create$,
  IllegalStateException_init_$Create$1nm9y6jd3c9iy as IllegalStateException_init_$Create$,
  joinToString1cxrrlmo0chqs as joinToString,
  initMetadataForObject1cxne3s9w65el as initMetadataForObject,
  Exceptiondt2hlxn7j7vw as Exception,
  Exception_init_$Init$25rnrjp6anyxk as Exception_init_$Init$,
  captureStack1fzi4aczwc4hg as captureStack,
  defineProp3hxgpk2knu2px as defineProp,
  compareTo3ankvs086tmwq as compareTo,
  fillArrayVali8eppxapiek4 as fillArrayVal,
  decodeToString1dbzcjd620q25 as decodeToString,
  Randomei1bbeye8rr8 as Random,
  ArrayList_init_$Create$3m1kyiqequwm5 as ArrayList_init_$Create$_0,
  split2bvyvnrlcifjv as split,
  first58ocm7j58k3q as first,
  isCharSequence1ju9jr1w86plq as isCharSequence,
  trim11nh7r46at6sx as trim,
  drop3na99dw9feawf as drop,
  noWhenBranchMatchedException2a6r7ubxgky5j as noWhenBranchMatchedException,
} from './kotlin-kotlin-stdlib.mjs';
import {
  Dispatchers_getInstance2xomc0oxzllw9 as Dispatchers_getInstance,
  launch1c91vkjzdi9sd as launch,
  CoroutineStart_UNDISPATCHED_getInstance36t7e2kqqnuqp as CoroutineStart_UNDISPATCHED_getInstance,
  ChannelResult2y4k69ac6y3du as ChannelResult,
  _ChannelResult___get_isSuccess__impl__odq1z92rhkz5ot7gudq as _ChannelResult___get_isSuccess__impl__odq1z9,
  CoroutineScopefcb5f5dwqcas as CoroutineScope,
  cancelConsumed2i0oizqhmljf6 as cancelConsumed,
  ClosedSendChannelException29m33prpq9jaw as ClosedSendChannelException,
  ClosedReceiveChannelException3ofg6gf5f5b38 as ClosedReceiveChannelException,
  CompletableDeferred2lnqvsbvx74d3 as CompletableDeferred,
  Channel3r72atmcithql as Channel,
  Key_instance2expa55gr45sc as Key_instance,
  Job13y4jkazwjho0 as Job,
  CoroutineName2g5zosw74tf0f as CoroutineName,
  CopyableThrowable1mvc99jcyvivf as CopyableThrowable,
  withTimeoutOrNullttha8n980jxd as withTimeoutOrNull,
} from './kotlinx-coroutines-core.mjs';
import {
  get_isTraceEnabled82xibuu04nxp as get_isTraceEnabled,
  ChannelIOException2i3t76lsrbgox as ChannelIOException,
  KtorSimpleLogger1xdphsp5l4e48 as KtorSimpleLogger,
  initCauseBridge1upxfqhavblt6 as initCauseBridge,
  getTimeMillis12o7k17x9fmwi as getTimeMillis,
  hex2ofqpe9ngcu1i as hex,
} from './ktor-ktor-utils.mjs';
import {
  BytePacketBuilder2biodf4wxvlba as BytePacketBuilder,
  writeFully359t6q8kam2g5 as writeFully,
  buildjygoh729rhy8 as build,
  get_size2imoy2jq11jxl as get_size,
  readText27783kyxjxi1g as readText,
  Charsets_getInstance193f5sla8amhs as Charsets_getInstance,
  toByteArray1i3ns5jnoqlv6 as toByteArray,
  writeText19qfzm98fbm4l as writeText,
} from './ktor-ktor-io.mjs';
import {
  readByteArray1ri21h2rciakw as readByteArray,
  IOException_init_$Create$2ud7rnqxh44u0 as IOException_init_$Create$,
  Buffergs925ekssbch as Buffer,
} from './kotlinx-io-kotlinx-io-core.mjs';
import {
  atomic$ref$130aurmcwdfdf1 as atomic$ref$1,
  atomic$boolean$1iggki4z65a2h as atomic$boolean$1,
} from './kotlinx-atomicfu.mjs';
//region block: imports
var imul = Math.imul;
//endregion
//region block: pre-declaration
initMetadataForCompanion(Companion);
initMetadataForClass(Codes, 'Codes', VOID, Enum);
initMetadataForClass(CloseReason, 'CloseReason');
function send(frame, $completion) {
  return this.k2n().l12(frame, $completion);
}
initMetadataForInterface(WebSocketSession, 'WebSocketSession', VOID, VOID, [CoroutineScope], [1, 0]);
initMetadataForInterface(DefaultWebSocketSession, 'DefaultWebSocketSession', VOID, VOID, [WebSocketSession], [1, 0]);
initMetadataForCompanion(Companion_0);
initMetadataForLambda(DefaultWebSocketSessionImpl$runIncomingProcessor$slambda, CoroutineImpl, VOID, [1]);
initMetadataForLambda(DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda, CoroutineImpl, VOID, [1]);
initMetadataForLambda(DefaultWebSocketSessionImpl$runOrCancelPinger$slambda, CoroutineImpl, VOID, [1]);
initMetadataForCoroutine($outgoingProcessorLoopCOROUTINE$0, CoroutineImpl);
initMetadataForCoroutine($sendCloseSequenceCOROUTINE$1, CoroutineImpl);
initMetadataForCoroutine($checkMaxFrameSizeCOROUTINE$2, CoroutineImpl);
initMetadataForClass(DefaultWebSocketSessionImpl, 'DefaultWebSocketSessionImpl', VOID, VOID, [DefaultWebSocketSession, WebSocketSession], [1, 0, 2]);
initMetadataForObject(NonDisposableHandle, 'NonDisposableHandle');
initMetadataForClass(FrameTooBigException, 'FrameTooBigException', VOID, Exception, [Exception, CopyableThrowable]);
initMetadataForCompanion(Companion_1);
initMetadataForClass(FrameType, 'FrameType', VOID, Enum);
initMetadataForLambda(ponger$slambda, CoroutineImpl, VOID, [1]);
initMetadataForLambda(pinger$slambda$slambda, CoroutineImpl, VOID, [1]);
initMetadataForLambda(pinger$slambda$slambda_1, CoroutineImpl, VOID, [1]);
initMetadataForLambda(pinger$slambda, CoroutineImpl, VOID, [1]);
initMetadataForInterface(WebSocketExtension, 'WebSocketExtension');
initMetadataForClass(WebSocketExtensionsConfig, 'WebSocketExtensionsConfig', WebSocketExtensionsConfig);
initMetadataForClass(WebSocketExtensionHeader, 'WebSocketExtensionHeader');
initMetadataForCoroutine($closeCOROUTINE$3, CoroutineImpl);
initMetadataForClass(Frame, 'Frame');
initMetadataForClass(Binary, 'Binary', VOID, Frame);
initMetadataForClass(Text, 'Text', VOID, Frame);
initMetadataForClass(Close, 'Close', Close_init_$Create$_0, Frame);
initMetadataForClass(Ping, 'Ping', VOID, Frame);
initMetadataForClass(Pong, 'Pong', VOID, Frame);
initMetadataForCompanion(Companion_2);
//endregion
var Codes_NORMAL_instance;
var Codes_GOING_AWAY_instance;
var Codes_PROTOCOL_ERROR_instance;
var Codes_CANNOT_ACCEPT_instance;
var Codes_CLOSED_ABNORMALLY_instance;
var Codes_NOT_CONSISTENT_instance;
var Codes_VIOLATED_POLICY_instance;
var Codes_TOO_BIG_instance;
var Codes_NO_EXTENSION_instance;
var Codes_INTERNAL_ERROR_instance;
var Codes_SERVICE_RESTART_instance;
var Codes_TRY_AGAIN_LATER_instance;
function Companion() {
  Companion_instance = this;
  var tmp = this;
  // Inline function 'kotlin.collections.associateBy' call
  var this_0 = get_entries();
  var capacity = coerceAtLeast(mapCapacity(collectionSizeOrDefault(this_0, 10)), 16);
  // Inline function 'kotlin.collections.associateByTo' call
  var destination = LinkedHashMap_init_$Create$(capacity);
  var tmp0_iterator = this_0.m();
  while (tmp0_iterator.n()) {
    var element = tmp0_iterator.o();
    // Inline function 'io.ktor.websocket.Companion.byCodeMap.<anonymous>' call
    var tmp$ret$0 = element.z2m_1;
    destination.j2(tmp$ret$0, element);
  }
  tmp.a2n_1 = destination;
  this.b2n_1 = Codes_INTERNAL_ERROR_getInstance();
}
protoOf(Companion).c2n = function (code) {
  return this.a2n_1.g2(code);
};
var Companion_instance;
function Companion_getInstance() {
  Codes_initEntries();
  if (Companion_instance == null)
    new Companion();
  return Companion_instance;
}
function values() {
  return [Codes_NORMAL_getInstance(), Codes_GOING_AWAY_getInstance(), Codes_PROTOCOL_ERROR_getInstance(), Codes_CANNOT_ACCEPT_getInstance(), Codes_CLOSED_ABNORMALLY_getInstance(), Codes_NOT_CONSISTENT_getInstance(), Codes_VIOLATED_POLICY_getInstance(), Codes_TOO_BIG_getInstance(), Codes_NO_EXTENSION_getInstance(), Codes_INTERNAL_ERROR_getInstance(), Codes_SERVICE_RESTART_getInstance(), Codes_TRY_AGAIN_LATER_getInstance()];
}
function get_entries() {
  if ($ENTRIES == null)
    $ENTRIES = enumEntries(values());
  return $ENTRIES;
}
var Codes_entriesInitialized;
function Codes_initEntries() {
  if (Codes_entriesInitialized)
    return Unit_instance;
  Codes_entriesInitialized = true;
  Codes_NORMAL_instance = new Codes('NORMAL', 0, 1000);
  Codes_GOING_AWAY_instance = new Codes('GOING_AWAY', 1, 1001);
  Codes_PROTOCOL_ERROR_instance = new Codes('PROTOCOL_ERROR', 2, 1002);
  Codes_CANNOT_ACCEPT_instance = new Codes('CANNOT_ACCEPT', 3, 1003);
  Codes_CLOSED_ABNORMALLY_instance = new Codes('CLOSED_ABNORMALLY', 4, 1006);
  Codes_NOT_CONSISTENT_instance = new Codes('NOT_CONSISTENT', 5, 1007);
  Codes_VIOLATED_POLICY_instance = new Codes('VIOLATED_POLICY', 6, 1008);
  Codes_TOO_BIG_instance = new Codes('TOO_BIG', 7, 1009);
  Codes_NO_EXTENSION_instance = new Codes('NO_EXTENSION', 8, 1010);
  Codes_INTERNAL_ERROR_instance = new Codes('INTERNAL_ERROR', 9, 1011);
  Codes_SERVICE_RESTART_instance = new Codes('SERVICE_RESTART', 10, 1012);
  Codes_TRY_AGAIN_LATER_instance = new Codes('TRY_AGAIN_LATER', 11, 1013);
  Companion_getInstance();
}
var $ENTRIES;
function CloseReason_init_$Init$(code, message, $this) {
  CloseReason.call($this, code.z2m_1, message);
  return $this;
}
function CloseReason_init_$Create$(code, message) {
  return CloseReason_init_$Init$(code, message, objectCreate(protoOf(CloseReason)));
}
function Codes(name, ordinal, code) {
  Enum.call(this, name, ordinal);
  this.z2m_1 = code;
}
function Codes_NORMAL_getInstance() {
  Codes_initEntries();
  return Codes_NORMAL_instance;
}
function Codes_GOING_AWAY_getInstance() {
  Codes_initEntries();
  return Codes_GOING_AWAY_instance;
}
function Codes_PROTOCOL_ERROR_getInstance() {
  Codes_initEntries();
  return Codes_PROTOCOL_ERROR_instance;
}
function Codes_CANNOT_ACCEPT_getInstance() {
  Codes_initEntries();
  return Codes_CANNOT_ACCEPT_instance;
}
function Codes_CLOSED_ABNORMALLY_getInstance() {
  Codes_initEntries();
  return Codes_CLOSED_ABNORMALLY_instance;
}
function Codes_NOT_CONSISTENT_getInstance() {
  Codes_initEntries();
  return Codes_NOT_CONSISTENT_instance;
}
function Codes_VIOLATED_POLICY_getInstance() {
  Codes_initEntries();
  return Codes_VIOLATED_POLICY_instance;
}
function Codes_TOO_BIG_getInstance() {
  Codes_initEntries();
  return Codes_TOO_BIG_instance;
}
function Codes_NO_EXTENSION_getInstance() {
  Codes_initEntries();
  return Codes_NO_EXTENSION_instance;
}
function Codes_INTERNAL_ERROR_getInstance() {
  Codes_initEntries();
  return Codes_INTERNAL_ERROR_instance;
}
function Codes_SERVICE_RESTART_getInstance() {
  Codes_initEntries();
  return Codes_SERVICE_RESTART_instance;
}
function Codes_TRY_AGAIN_LATER_getInstance() {
  Codes_initEntries();
  return Codes_TRY_AGAIN_LATER_instance;
}
function CloseReason(code, message) {
  this.d2n_1 = code;
  this.e2n_1 = message;
}
protoOf(CloseReason).f2n = function () {
  return Companion_getInstance().c2n(this.d2n_1);
};
protoOf(CloseReason).toString = function () {
  var tmp0_elvis_lhs = this.f2n();
  return 'CloseReason(reason=' + toString(tmp0_elvis_lhs == null ? this.d2n_1 : tmp0_elvis_lhs) + ', message=' + this.e2n_1 + ')';
};
protoOf(CloseReason).hashCode = function () {
  var result = this.d2n_1;
  result = imul(result, 31) + getStringHashCode(this.e2n_1) | 0;
  return result;
};
protoOf(CloseReason).equals = function (other) {
  if (this === other)
    return true;
  if (!(other instanceof CloseReason))
    return false;
  var tmp0_other_with_cast = other instanceof CloseReason ? other : THROW_CCE();
  if (!(this.d2n_1 === tmp0_other_with_cast.d2n_1))
    return false;
  if (!(this.e2n_1 === tmp0_other_with_cast.e2n_1))
    return false;
  return true;
};
function get_LOGGER() {
  _init_properties_DefaultWebSocketSession_kt__469s0y();
  return LOGGER;
}
var LOGGER;
function get_IncomingProcessorCoroutineName() {
  _init_properties_DefaultWebSocketSession_kt__469s0y();
  return IncomingProcessorCoroutineName;
}
var IncomingProcessorCoroutineName;
function get_OutgoingProcessorCoroutineName() {
  _init_properties_DefaultWebSocketSession_kt__469s0y();
  return OutgoingProcessorCoroutineName;
}
var OutgoingProcessorCoroutineName;
function get_NORMAL_CLOSE() {
  _init_properties_DefaultWebSocketSession_kt__469s0y();
  return NORMAL_CLOSE;
}
var NORMAL_CLOSE;
function DefaultWebSocketSession() {
}
function DefaultWebSocketSession_0(session, pingIntervalMillis, timeoutMillis) {
  pingIntervalMillis = pingIntervalMillis === VOID ? new Long(0, 0) : pingIntervalMillis;
  timeoutMillis = timeoutMillis === VOID ? new Long(15000, 0) : timeoutMillis;
  _init_properties_DefaultWebSocketSession_kt__469s0y();
  // Inline function 'kotlin.require' call
  // Inline function 'kotlin.contracts.contract' call
  if (!!isInterface(session, DefaultWebSocketSession)) {
    // Inline function 'io.ktor.websocket.DefaultWebSocketSession.<anonymous>' call
    var message = 'Cannot wrap other DefaultWebSocketSession';
    throw IllegalArgumentException_init_$Create$(toString(message));
  }
  return new DefaultWebSocketSessionImpl(session, pingIntervalMillis, timeoutMillis);
}
function runIncomingProcessor($this, ponger) {
  var tmp = get_IncomingProcessorCoroutineName().se(Dispatchers_getInstance().qv_1);
  return launch($this, tmp, VOID, DefaultWebSocketSessionImpl$runIncomingProcessor$slambda_0($this, ponger, null));
}
function runOutgoingProcessor($this) {
  var tmp = get_OutgoingProcessorCoroutineName().se(Dispatchers_getInstance().qv_1);
  var tmp_0 = CoroutineStart_UNDISPATCHED_getInstance();
  return launch($this, tmp, tmp_0, DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda_0($this, null));
}
function outgoingProcessorLoop($this, $completion) {
  var tmp = new $outgoingProcessorLoopCOROUTINE$0($this, $completion);
  tmp.m8_1 = Unit_instance;
  tmp.n8_1 = null;
  return tmp.s8();
}
function sendCloseSequence($this, reason, exception, $completion) {
  var tmp = new $sendCloseSequenceCOROUTINE$1($this, reason, exception, $completion);
  tmp.m8_1 = Unit_instance;
  tmp.n8_1 = null;
  return tmp.s8();
}
function sendCloseSequence$default($this, reason, exception, $completion, $super) {
  exception = exception === VOID ? null : exception;
  return sendCloseSequence($this, reason, exception, $completion);
}
function tryClose($this) {
  return $this.s2o_1.atomicfu$compareAndSet(false, true);
}
function runOrCancelPinger($this) {
  var interval = $this.x2o_1;
  var tmp;
  if ($this.s2o_1.kotlinx$atomicfu$value) {
    tmp = null;
  } else if (interval.e1(new Long(0, 0)) > 0) {
    var tmp_0 = $this.n2o_1.k2n();
    var tmp_1 = $this.y2o_1;
    tmp = pinger($this, tmp_0, interval, tmp_1, DefaultWebSocketSessionImpl$runOrCancelPinger$slambda_0($this, null));
  } else {
    tmp = null;
  }
  var newPinger = tmp;
  var tmp0_safe_receiver = $this.o2o_1.atomicfu$getAndSet(newPinger);
  if (tmp0_safe_receiver == null)
    null;
  else
    tmp0_safe_receiver.t12();
  var tmp2_safe_receiver = newPinger == null ? null : new ChannelResult(newPinger.m12(Companion_getInstance_0().a2p_1));
  if (tmp2_safe_receiver == null)
    null;
  else
    _ChannelResult___get_isSuccess__impl__odq1z9(tmp2_safe_receiver.m10_1);
  if ($this.s2o_1.kotlinx$atomicfu$value && !(newPinger == null)) {
    runOrCancelPinger($this);
  }
}
function checkMaxFrameSize($this, packet, frame, $completion) {
  var tmp = new $checkMaxFrameSizeCOROUTINE$2($this, packet, frame, $completion);
  tmp.m8_1 = Unit_instance;
  tmp.n8_1 = null;
  return tmp.s8();
}
function processIncomingExtensions($this, frame) {
  // Inline function 'kotlin.collections.fold' call
  var accumulator = frame;
  var tmp0_iterator = $this.n2p().m();
  while (tmp0_iterator.n()) {
    var element = tmp0_iterator.o();
    // Inline function 'io.ktor.websocket.DefaultWebSocketSessionImpl.processIncomingExtensions.<anonymous>' call
    var current = accumulator;
    accumulator = element.o2p(current);
  }
  return accumulator;
}
function processOutgoingExtensions($this, frame) {
  // Inline function 'kotlin.collections.fold' call
  var accumulator = frame;
  var tmp0_iterator = $this.n2p().m();
  while (tmp0_iterator.n()) {
    var element = tmp0_iterator.o();
    // Inline function 'io.ktor.websocket.DefaultWebSocketSessionImpl.processOutgoingExtensions.<anonymous>' call
    var current = accumulator;
    accumulator = element.p2p(current);
  }
  return accumulator;
}
function Companion_0() {
  Companion_instance_0 = this;
  this.a2p_1 = new Pong(new Int8Array(0), NonDisposableHandle_instance);
}
var Companion_instance_0;
function Companion_getInstance_0() {
  if (Companion_instance_0 == null)
    new Companion_0();
  return Companion_instance_0;
}
function DefaultWebSocketSessionImpl$runIncomingProcessor$slambda(this$0, $ponger, resultContinuation) {
  this.y2p_1 = this$0;
  this.z2p_1 = $ponger;
  CoroutineImpl.call(this, resultContinuation);
}
protoOf(DefaultWebSocketSessionImpl$runIncomingProcessor$slambda).z1i = function ($this$launch, $completion) {
  var tmp = this.a1j($this$launch, $completion);
  tmp.m8_1 = Unit_instance;
  tmp.n8_1 = null;
  return tmp.s8();
};
protoOf(DefaultWebSocketSessionImpl$runIncomingProcessor$slambda).c9 = function (p1, $completion) {
  return this.z1i((!(p1 == null) ? isInterface(p1, CoroutineScope) : false) ? p1 : THROW_CCE(), $completion);
};
protoOf(DefaultWebSocketSessionImpl$runIncomingProcessor$slambda).s8 = function () {
  var suspendResult = this.m8_1;
  $sm: do
    try {
      var tmp = this.k8_1;
      switch (tmp) {
        case 0:
          this.l8_1 = 39;
          this.b2q_1 = null;
          this.c2q_1 = null;
          this.d2q_1 = false;
          this.e2q_1 = Unit_instance;
          this.k8_1 = 1;
          continue $sm;
        case 1:
          this.k8_1 = 2;
          continue $sm;
        case 2:
          this.l8_1 = 33;
          this.l8_1 = 32;
          var tmp_0 = this;
          tmp_0.g2q_1 = this.y2p_1.n2o_1.j2n();
          this.k8_1 = 3;
          continue $sm;
        case 3:
          var tmp_1 = this;
          tmp_1.i2q_1 = this.g2q_1;
          this.j2q_1 = null;
          this.k8_1 = 4;
          continue $sm;
        case 4:
          this.k8_1 = 5;
          continue $sm;
        case 5:
          this.k8_1 = 6;
          continue $sm;
        case 6:
          this.l8_1 = 29;
          this.l8_1 = 28;
          var tmp_2 = this;
          tmp_2.m2q_1 = this.i2q_1;
          this.n2q_1 = this.m2q_1.m();
          this.k8_1 = 7;
          continue $sm;
        case 7:
          this.k8_1 = 8;
          suspendResult = this.n2q_1.e10(this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 8:
          if (!suspendResult) {
            this.k8_1 = 26;
            continue $sm;
          }

          this.o2q_1 = this.n2q_1.o();
          this.k8_1 = 9;
          continue $sm;
        case 9:
          var tmp_3 = this;
          tmp_3.q2q_1 = this.o2q_1;
          var this_0 = get_LOGGER();
          if (get_isTraceEnabled(this_0)) {
            this_0.r2a('WebSocketSession(' + toString(this.a2q_1) + ') receiving frame ' + this.q2q_1.toString());
          }

          this.r2q_1 = this.q2q_1;
          var tmp_4 = this.r2q_1;
          if (tmp_4 instanceof Close) {
            if (!this.y2p_1.k2n().g10()) {
              this.k8_1 = 18;
              var tmp_5 = this.y2p_1.k2n();
              var tmp1_elvis_lhs = readReason(this.q2q_1);
              suspendResult = tmp_5.l12(Close_init_$Create$(tmp1_elvis_lhs == null ? get_NORMAL_CLOSE() : tmp1_elvis_lhs), this);
              if (suspendResult === get_COROUTINE_SUSPENDED()) {
                return suspendResult;
              }
              continue $sm;
            } else {
              this.k8_1 = 19;
              continue $sm;
            }
          } else {
            var tmp_6 = this.r2q_1;
            if (tmp_6 instanceof Pong) {
              this.t2q_1 = this.y2p_1.o2o_1.kotlinx$atomicfu$value;
              if (this.t2q_1 == null) {
                this.u2q_1 = null;
                this.k8_1 = 17;
                continue $sm;
              } else {
                this.k8_1 = 16;
                suspendResult = this.t2q_1.l12(this.q2q_1, this);
                if (suspendResult === get_COROUTINE_SUSPENDED()) {
                  return suspendResult;
                }
                continue $sm;
              }
            } else {
              var tmp_7 = this.r2q_1;
              if (tmp_7 instanceof Ping) {
                this.k8_1 = 15;
                suspendResult = this.z2p_1.l12(this.q2q_1, this);
                if (suspendResult === get_COROUTINE_SUSPENDED()) {
                  return suspendResult;
                }
                continue $sm;
              } else {
                this.k8_1 = 10;
                suspendResult = checkMaxFrameSize(this.y2p_1, this.c2q_1, this.q2q_1, this);
                if (suspendResult === get_COROUTINE_SUSPENDED()) {
                  return suspendResult;
                }
                continue $sm;
              }
            }
          }

        case 10:
          if (!this.q2q_1.c2r_1) {
            if (this.b2q_1 == null) {
              this.b2q_1 = this.q2q_1;
            }
            if (this.c2q_1 == null) {
              this.c2q_1 = BytePacketBuilder();
            }
            writeFully(ensureNotNull(this.c2q_1), this.q2q_1.e2r_1);
            this.p2q_1 = Unit_instance;
            this.k8_1 = 21;
            continue $sm;
          } else {
            this.k8_1 = 11;
            continue $sm;
          }

        case 11:
          if (this.b2q_1 == null) {
            this.k8_1 = 14;
            suspendResult = this.y2p_1.q2o_1.l12(processIncomingExtensions(this.y2p_1, this.q2q_1), this);
            if (suspendResult === get_COROUTINE_SUSPENDED()) {
              return suspendResult;
            }
            continue $sm;
          } else {
            this.k8_1 = 12;
            continue $sm;
          }

        case 12:
          writeFully(ensureNotNull(this.c2q_1), this.q2q_1.e2r_1);
          this.v2q_1 = Companion_getInstance_2().k2r(true, ensureNotNull(this.b2q_1).d2r_1, readByteArray(build(ensureNotNull(this.c2q_1))), ensureNotNull(this.b2q_1).g2r_1, ensureNotNull(this.b2q_1).h2r_1, ensureNotNull(this.b2q_1).i2r_1);
          this.b2q_1 = null;
          this.k8_1 = 13;
          suspendResult = this.y2p_1.q2o_1.l12(processIncomingExtensions(this.y2p_1, this.v2q_1), this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 13:
          var tmp_8 = this;
          tmp_8.s2q_1 = Unit_instance;
          this.k8_1 = 20;
          continue $sm;
        case 14:
          this.p2q_1 = Unit_instance;
          this.k8_1 = 21;
          continue $sm;
        case 15:
          var tmp_9 = this;
          tmp_9.s2q_1 = Unit_instance;
          this.k8_1 = 20;
          continue $sm;
        case 16:
          var tmp_10 = this;
          tmp_10.u2q_1 = Unit_instance;
          this.k8_1 = 17;
          continue $sm;
        case 17:
          this.s2q_1 = this.u2q_1;
          this.k8_1 = 20;
          continue $sm;
        case 18:
          this.k8_1 = 19;
          continue $sm;
        case 19:
          this.d2q_1 = true;
          this.l2q_1 = Unit_instance;
          this.k8_1 = 22;
          var tmp_11 = this;
          continue $sm;
        case 20:
          if (false) {
            this.k8_1 = 9;
            continue $sm;
          }

          this.k8_1 = 21;
          continue $sm;
        case 21:
          this.k8_1 = 7;
          continue $sm;
        case 22:
          this.l8_1 = 32;
          var tmp_12 = this;
          cancelConsumed(this.i2q_1, this.j2q_1);
          tmp_12.f2q_1 = Unit_instance;
          this.l8_1 = 39;
          this.k8_1 = 23;
          continue $sm;
        case 23:
          this.l8_1 = 39;
          this.z2p_1.t12();
          var tmp0_safe_receiver = this.c2q_1;
          if (tmp0_safe_receiver == null)
            null;
          else {
            tmp0_safe_receiver.d1b();
          }

          this.y2p_1.q2o_1.t12();
          if (!this.d2q_1) {
            this.k8_1 = 24;
            suspendResult = close(this.y2p_1, CloseReason_init_$Create$(Codes_CLOSED_ABNORMALLY_getInstance(), 'Connection was closed without close frame'), this);
            if (suspendResult === get_COROUTINE_SUSPENDED()) {
              return suspendResult;
            }
            continue $sm;
          } else {
            this.k8_1 = 25;
            continue $sm;
          }

        case 24:
          this.k8_1 = 25;
          continue $sm;
        case 25:
          var tmp_13 = this;
          return Unit_instance;
        case 26:
          this.k2q_1 = Unit_instance;
          this.k8_1 = 27;
          var tmp_14 = this;
          continue $sm;
        case 27:
          this.l8_1 = 32;
          var tmp_15 = this;
          cancelConsumed(this.i2q_1, this.j2q_1);
          tmp_15.h2q_1 = Unit_instance;
          this.k8_1 = 31;
          continue $sm;
        case 28:
          this.l8_1 = 29;
          var tmp_16 = this.n8_1;
          if (tmp_16 instanceof Error) {
            this.w2q_1 = this.n8_1;
            var tmp_17 = this;
            this.j2q_1 = this.w2q_1;
            throw this.w2q_1;
          } else {
            throw this.n8_1;
          }

        case 29:
          this.l8_1 = 32;
          this.x2q_1 = this.n8_1;
          cancelConsumed(this.i2q_1, this.j2q_1);
          throw this.x2q_1;
        case 30:
          this.l8_1 = 32;
          cancelConsumed(this.i2q_1, this.j2q_1);
          if (false) {
            this.k8_1 = 3;
            continue $sm;
          }

          this.k8_1 = 31;
          continue $sm;
        case 31:
          this.e2q_1 = Unit_instance;
          this.l8_1 = 39;
          this.k8_1 = 36;
          continue $sm;
        case 32:
          this.l8_1 = 33;
          var tmp_18 = this.n8_1;
          if (tmp_18 instanceof ClosedSendChannelException) {
            this.y2q_1 = this.n8_1;
            var tmp_19 = this;
            tmp_19.e2q_1 = Unit_instance;
            this.l8_1 = 39;
            this.k8_1 = 36;
            continue $sm;
          } else {
            var tmp_20 = this.n8_1;
            if (tmp_20 instanceof Error) {
              this.z2q_1 = this.n8_1;
              var tmp_21 = this;
              this.z2p_1.t12();
              tmp_21.e2q_1 = this.y2p_1.q2o_1.r12(this.z2q_1);
              this.l8_1 = 39;
              this.k8_1 = 36;
              continue $sm;
            } else {
              throw this.n8_1;
            }
          }

        case 33:
          this.l8_1 = 39;
          this.a2r_1 = this.n8_1;
          this.z2p_1.t12();
          var tmp0_safe_receiver_0 = this.c2q_1;
          if (tmp0_safe_receiver_0 == null)
            null;
          else {
            tmp0_safe_receiver_0.d1b();
          }

          this.y2p_1.q2o_1.t12();
          if (!this.d2q_1) {
            this.k8_1 = 34;
            suspendResult = close(this.y2p_1, CloseReason_init_$Create$(Codes_CLOSED_ABNORMALLY_getInstance(), 'Connection was closed without close frame'), this);
            if (suspendResult === get_COROUTINE_SUSPENDED()) {
              return suspendResult;
            }
            continue $sm;
          } else {
            this.k8_1 = 35;
            continue $sm;
          }

        case 34:
          this.k8_1 = 35;
          continue $sm;
        case 35:
          throw this.a2r_1;
        case 36:
          this.b2r_1 = this.e2q_1;
          this.l8_1 = 39;
          this.z2p_1.t12();
          var tmp0_safe_receiver_1 = this.c2q_1;
          if (tmp0_safe_receiver_1 == null)
            null;
          else {
            tmp0_safe_receiver_1.d1b();
          }

          this.y2p_1.q2o_1.t12();
          if (!this.d2q_1) {
            this.k8_1 = 37;
            suspendResult = close(this.y2p_1, CloseReason_init_$Create$(Codes_CLOSED_ABNORMALLY_getInstance(), 'Connection was closed without close frame'), this);
            if (suspendResult === get_COROUTINE_SUSPENDED()) {
              return suspendResult;
            }
            continue $sm;
          } else {
            this.k8_1 = 38;
            continue $sm;
          }

        case 37:
          this.k8_1 = 38;
          continue $sm;
        case 38:
          return Unit_instance;
        case 39:
          throw this.n8_1;
      }
    } catch ($p) {
      var e = $p;
      if (this.l8_1 === 39) {
        throw e;
      } else {
        this.k8_1 = this.l8_1;
        this.n8_1 = e;
      }
    }
   while (true);
};
protoOf(DefaultWebSocketSessionImpl$runIncomingProcessor$slambda).a1j = function ($this$launch, completion) {
  var i = new DefaultWebSocketSessionImpl$runIncomingProcessor$slambda(this.y2p_1, this.z2p_1, completion);
  i.a2q_1 = $this$launch;
  return i;
};
function DefaultWebSocketSessionImpl$runIncomingProcessor$slambda_0(this$0, $ponger, resultContinuation) {
  var i = new DefaultWebSocketSessionImpl$runIncomingProcessor$slambda(this$0, $ponger, resultContinuation);
  var l = function ($this$launch, $completion) {
    return i.z1i($this$launch, $completion);
  };
  l.$arity = 1;
  return l;
}
function DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda(this$0, resultContinuation) {
  this.t2r_1 = this$0;
  CoroutineImpl.call(this, resultContinuation);
}
protoOf(DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda).z1i = function ($this$launch, $completion) {
  var tmp = this.a1j($this$launch, $completion);
  tmp.m8_1 = Unit_instance;
  tmp.n8_1 = null;
  return tmp.s8();
};
protoOf(DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda).c9 = function (p1, $completion) {
  return this.z1i((!(p1 == null) ? isInterface(p1, CoroutineScope) : false) ? p1 : THROW_CCE(), $completion);
};
protoOf(DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda).s8 = function () {
  var suspendResult = this.m8_1;
  $sm: do
    try {
      var tmp = this.k8_1;
      switch (tmp) {
        case 0:
          this.l8_1 = 10;
          this.k8_1 = 1;
          continue $sm;
        case 1:
          this.l8_1 = 6;
          this.l8_1 = 3;
          this.k8_1 = 2;
          suspendResult = outgoingProcessorLoop(this.t2r_1, this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 2:
          this.v2r_1 = suspendResult;
          this.l8_1 = 10;
          this.k8_1 = 8;
          continue $sm;
        case 3:
          this.l8_1 = 6;
          var tmp_0 = this.n8_1;
          if (tmp_0 instanceof ClosedSendChannelException) {
            this.w2r_1 = this.n8_1;
            var tmp_1 = this;
            tmp_1.v2r_1 = Unit_instance;
            this.l8_1 = 10;
            this.k8_1 = 8;
            continue $sm;
          } else {
            var tmp_2 = this.n8_1;
            if (tmp_2 instanceof ClosedReceiveChannelException) {
              this.x2r_1 = this.n8_1;
              var tmp_3 = this;
              tmp_3.v2r_1 = Unit_instance;
              this.l8_1 = 10;
              this.k8_1 = 8;
              continue $sm;
            } else {
              var tmp_4 = this.n8_1;
              if (tmp_4 instanceof CancellationException) {
                this.y2r_1 = this.n8_1;
                this.k8_1 = 4;
                suspendResult = sendCloseSequence$default(this.t2r_1, CloseReason_init_$Create$(Codes_NORMAL_getInstance(), ''), VOID, this);
                if (suspendResult === get_COROUTINE_SUSPENDED()) {
                  return suspendResult;
                }
                continue $sm;
              } else {
                var tmp_5 = this.n8_1;
                if (tmp_5 instanceof ChannelIOException) {
                  this.z2r_1 = this.n8_1;
                  var tmp_6 = this;
                  tmp_6.v2r_1 = Unit_instance;
                  this.l8_1 = 10;
                  this.k8_1 = 8;
                  continue $sm;
                } else {
                  var tmp_7 = this.n8_1;
                  if (tmp_7 instanceof Error) {
                    this.a2s_1 = this.n8_1;
                    this.t2r_1.r2o_1.fm(CancellationException_init_$Create$('Failed to send frame', this.a2s_1));
                    this.k8_1 = 5;
                    suspendResult = closeExceptionally(this.t2r_1.n2o_1, this.a2s_1, this);
                    if (suspendResult === get_COROUTINE_SUSPENDED()) {
                      return suspendResult;
                    }
                    continue $sm;
                  } else {
                    throw this.n8_1;
                  }
                }
              }
            }
          }

        case 4:
          this.v2r_1 = suspendResult;
          this.l8_1 = 10;
          this.k8_1 = 8;
          continue $sm;
        case 5:
          this.v2r_1 = suspendResult;
          this.l8_1 = 10;
          this.k8_1 = 8;
          continue $sm;
        case 6:
          this.l8_1 = 10;
          this.b2s_1 = this.n8_1;
          this.t2r_1.r2o_1.v12();
          this.k8_1 = 7;
          suspendResult = close(this.t2r_1.n2o_1, VOID, this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 7:
          throw this.b2s_1;
        case 8:
          this.l8_1 = 10;
          this.t2r_1.r2o_1.v12();
          this.k8_1 = 9;
          suspendResult = close(this.t2r_1.n2o_1, VOID, this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 9:
          return Unit_instance;
        case 10:
          throw this.n8_1;
      }
    } catch ($p) {
      var e = $p;
      if (this.l8_1 === 10) {
        throw e;
      } else {
        this.k8_1 = this.l8_1;
        this.n8_1 = e;
      }
    }
   while (true);
};
protoOf(DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda).a1j = function ($this$launch, completion) {
  var i = new DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda(this.t2r_1, completion);
  i.u2r_1 = $this$launch;
  return i;
};
function DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda_0(this$0, resultContinuation) {
  var i = new DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda(this$0, resultContinuation);
  var l = function ($this$launch, $completion) {
    return i.z1i($this$launch, $completion);
  };
  l.$arity = 1;
  return l;
}
function DefaultWebSocketSessionImpl$runOrCancelPinger$slambda(this$0, resultContinuation) {
  this.k2s_1 = this$0;
  CoroutineImpl.call(this, resultContinuation);
}
protoOf(DefaultWebSocketSessionImpl$runOrCancelPinger$slambda).m2s = function (it, $completion) {
  var tmp = this.n2s(it, $completion);
  tmp.m8_1 = Unit_instance;
  tmp.n8_1 = null;
  return tmp.s8();
};
protoOf(DefaultWebSocketSessionImpl$runOrCancelPinger$slambda).c9 = function (p1, $completion) {
  return this.m2s(p1 instanceof CloseReason ? p1 : THROW_CCE(), $completion);
};
protoOf(DefaultWebSocketSessionImpl$runOrCancelPinger$slambda).s8 = function () {
  var suspendResult = this.m8_1;
  $sm: do
    try {
      var tmp = this.k8_1;
      switch (tmp) {
        case 0:
          this.l8_1 = 2;
          this.k8_1 = 1;
          suspendResult = sendCloseSequence(this.k2s_1, this.l2s_1, IOException_init_$Create$('Ping timeout'), this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 1:
          return Unit_instance;
        case 2:
          throw this.n8_1;
      }
    } catch ($p) {
      var e = $p;
      if (this.l8_1 === 2) {
        throw e;
      } else {
        this.k8_1 = this.l8_1;
        this.n8_1 = e;
      }
    }
   while (true);
};
protoOf(DefaultWebSocketSessionImpl$runOrCancelPinger$slambda).n2s = function (it, completion) {
  var i = new DefaultWebSocketSessionImpl$runOrCancelPinger$slambda(this.k2s_1, completion);
  i.l2s_1 = it;
  return i;
};
function DefaultWebSocketSessionImpl$runOrCancelPinger$slambda_0(this$0, resultContinuation) {
  var i = new DefaultWebSocketSessionImpl$runOrCancelPinger$slambda(this$0, resultContinuation);
  var l = function (it, $completion) {
    return i.m2s(it, $completion);
  };
  l.$arity = 1;
  return l;
}
function $outgoingProcessorLoopCOROUTINE$0(_this__u8e3s4, resultContinuation) {
  CoroutineImpl.call(this, resultContinuation);
  this.u2n_1 = _this__u8e3s4;
}
protoOf($outgoingProcessorLoopCOROUTINE$0).s8 = function () {
  var suspendResult = this.m8_1;
  $sm: do
    try {
      var tmp = this.k8_1;
      switch (tmp) {
        case 0:
          this.l8_1 = 7;
          this.v2n_1 = this.u2n_1.r2o_1.m();
          this.k8_1 = 1;
          continue $sm;
        case 1:
          this.k8_1 = 2;
          suspendResult = this.v2n_1.e10(this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 2:
          if (!suspendResult) {
            this.k8_1 = 6;
            continue $sm;
          }

          this.w2n_1 = this.v2n_1.o();
          var this_0 = get_LOGGER();
          if (get_isTraceEnabled(this_0)) {
            this_0.r2a('Sending ' + this.w2n_1.toString() + ' from session ' + toString(this.u2n_1));
          }

          this.x2n_1 = this.w2n_1;
          var tmp_0 = this.x2n_1;
          if (tmp_0 instanceof Close) {
            this.k8_1 = 3;
            suspendResult = sendCloseSequence$default(this.u2n_1, readReason(this.w2n_1), VOID, this);
            if (suspendResult === get_COROUTINE_SUSPENDED()) {
              return suspendResult;
            }
            continue $sm;
          } else {
            var tmp_1;
            var tmp_2 = this.x2n_1;
            if (tmp_2 instanceof Text) {
              tmp_1 = true;
            } else {
              var tmp_3 = this.x2n_1;
              tmp_1 = tmp_3 instanceof Binary;
            }
            if (tmp_1) {
              this.y2n_1 = processOutgoingExtensions(this.u2n_1, this.w2n_1);
              this.k8_1 = 4;
              continue $sm;
            } else {
              this.y2n_1 = this.w2n_1;
              this.k8_1 = 4;
              continue $sm;
            }
          }

        case 3:
          this.k8_1 = 6;
          var tmp_4 = this;
          continue $sm;
        case 4:
          this.z2n_1 = this.y2n_1;
          this.k8_1 = 5;
          suspendResult = this.u2n_1.n2o_1.k2n().l12(this.z2n_1, this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 5:
          this.k8_1 = 1;
          continue $sm;
        case 6:
          return Unit_instance;
        case 7:
          throw this.n8_1;
      }
    } catch ($p) {
      var e = $p;
      if (this.l8_1 === 7) {
        throw e;
      } else {
        this.k8_1 = this.l8_1;
        this.n8_1 = e;
      }
    }
   while (true);
};
function $sendCloseSequenceCOROUTINE$1(_this__u8e3s4, reason, exception, resultContinuation) {
  CoroutineImpl.call(this, resultContinuation);
  this.i2o_1 = _this__u8e3s4;
  this.j2o_1 = reason;
  this.k2o_1 = exception;
}
protoOf($sendCloseSequenceCOROUTINE$1).s8 = function () {
  var suspendResult = this.m8_1;
  $sm: do
    try {
      var tmp = this.k8_1;
      switch (tmp) {
        case 0:
          this.l8_1 = 6;
          if (!tryClose(this.i2o_1))
            return Unit_instance;
          var this_0 = get_LOGGER();
          if (get_isTraceEnabled(this_0)) {
            this_0.r2a('Sending Close Sequence for session ' + toString(this.i2o_1) + ' with reason ' + toString_0(this.j2o_1) + ' and exception ' + toString_0(this.k2o_1));
          }

          this.i2o_1.t2o_1.sr();
          var tmp_0 = this;
          var tmp0_elvis_lhs = this.j2o_1;
          tmp_0.l2o_1 = tmp0_elvis_lhs == null ? CloseReason_init_$Create$(Codes_NORMAL_getInstance(), '') : tmp0_elvis_lhs;
          this.k8_1 = 1;
          continue $sm;
        case 1:
          this.l8_1 = 5;
          runOrCancelPinger(this.i2o_1);
          if (!(this.l2o_1.d2n_1 === Codes_CLOSED_ABNORMALLY_getInstance().z2m_1)) {
            this.k8_1 = 2;
            suspendResult = this.i2o_1.n2o_1.k2n().l12(Close_init_$Create$(this.l2o_1), this);
            if (suspendResult === get_COROUTINE_SUSPENDED()) {
              return suspendResult;
            }
            continue $sm;
          } else {
            this.k8_1 = 3;
            continue $sm;
          }

        case 2:
          this.k8_1 = 3;
          continue $sm;
        case 3:
          this.m2o_1 = Unit_instance;
          this.l8_1 = 6;
          this.k8_1 = 4;
          continue $sm;
        case 4:
          this.l8_1 = 6;
          this.i2o_1.p2o_1.pr(this.l2o_1);
          if (!(this.k2o_1 == null)) {
            this.i2o_1.r2o_1.r12(this.k2o_1);
            this.i2o_1.q2o_1.r12(this.k2o_1);
          }

          return Unit_instance;
        case 5:
          this.l8_1 = 6;
          var t = this.n8_1;
          this.i2o_1.p2o_1.pr(this.l2o_1);
          if (!(this.k2o_1 == null)) {
            this.i2o_1.r2o_1.r12(this.k2o_1);
            this.i2o_1.q2o_1.r12(this.k2o_1);
          }

          throw t;
        case 6:
          throw this.n8_1;
      }
    } catch ($p) {
      var e = $p;
      if (this.l8_1 === 6) {
        throw e;
      } else {
        this.k8_1 = this.l8_1;
        this.n8_1 = e;
      }
    }
   while (true);
};
function $checkMaxFrameSizeCOROUTINE$2(_this__u8e3s4, packet, frame, resultContinuation) {
  CoroutineImpl.call(this, resultContinuation);
  this.j2p_1 = _this__u8e3s4;
  this.k2p_1 = packet;
  this.l2p_1 = frame;
}
protoOf($checkMaxFrameSizeCOROUTINE$2).s8 = function () {
  var suspendResult = this.m8_1;
  $sm: do
    try {
      var tmp = this.k8_1;
      switch (tmp) {
        case 0:
          this.l8_1 = 3;
          var tmp_0 = this;
          var tmp_1 = this.l2p_1.e2r_1.length;
          var tmp0_safe_receiver = this.k2p_1;
          var tmp1_elvis_lhs = tmp0_safe_receiver == null ? null : get_size(tmp0_safe_receiver);
          tmp_0.m2p_1 = tmp_1 + (tmp1_elvis_lhs == null ? 0 : tmp1_elvis_lhs) | 0;
          if (toLong(this.m2p_1).e1(this.j2p_1.i2n()) > 0) {
            var tmp2_safe_receiver = this.k2p_1;
            if (tmp2_safe_receiver == null)
              null;
            else {
              tmp2_safe_receiver.d1b();
            }
            this.k8_1 = 2;
            suspendResult = close(this.j2p_1, CloseReason_init_$Create$(Codes_TOO_BIG_getInstance(), 'Frame is too big: ' + this.m2p_1 + '. Max size is ' + this.j2p_1.i2n().toString()), this);
            if (suspendResult === get_COROUTINE_SUSPENDED()) {
              return suspendResult;
            }
            continue $sm;
          } else {
            this.k8_1 = 1;
            continue $sm;
          }

        case 1:
          return Unit_instance;
        case 2:
          throw new FrameTooBigException(toLong(this.m2p_1));
        case 3:
          throw this.n8_1;
      }
    } catch ($p) {
      var e = $p;
      if (this.l8_1 === 3) {
        throw e;
      } else {
        this.k8_1 = this.l8_1;
        this.n8_1 = e;
      }
    }
   while (true);
};
function DefaultWebSocketSessionImpl(raw, pingIntervalMillis, timeoutMillis) {
  Companion_getInstance_0();
  this.n2o_1 = raw;
  this.o2o_1 = atomic$ref$1(null);
  this.p2o_1 = CompletableDeferred();
  this.q2o_1 = Channel(8);
  this.r2o_1 = Channel(get_OUTGOING_CHANNEL_CAPACITY());
  this.s2o_1 = atomic$boolean$1(false);
  this.t2o_1 = Job(this.n2o_1.xk().x8(Key_instance));
  var tmp = this;
  // Inline function 'kotlin.collections.mutableListOf' call
  tmp.u2o_1 = ArrayList_init_$Create$();
  this.v2o_1 = atomic$boolean$1(false);
  this.w2o_1 = this.n2o_1.xk().se(this.t2o_1).se(new CoroutineName('ws-default'));
  this.x2o_1 = pingIntervalMillis;
  this.y2o_1 = timeoutMillis;
  this.z2o_1 = this.p2o_1;
}
protoOf(DefaultWebSocketSessionImpl).j2n = function () {
  return this.q2o_1;
};
protoOf(DefaultWebSocketSessionImpl).k2n = function () {
  return this.r2o_1;
};
protoOf(DefaultWebSocketSessionImpl).n2p = function () {
  return this.u2o_1;
};
protoOf(DefaultWebSocketSessionImpl).xk = function () {
  return this.w2o_1;
};
protoOf(DefaultWebSocketSessionImpl).h2n = function (value) {
  this.n2o_1.h2n(value);
};
protoOf(DefaultWebSocketSessionImpl).i2n = function () {
  return this.n2o_1.i2n();
};
protoOf(DefaultWebSocketSessionImpl).g2n = function (negotiatedExtensions) {
  if (!this.v2o_1.atomicfu$compareAndSet(false, true)) {
    // Inline function 'kotlin.error' call
    var message = 'WebSocket session ' + toString(this) + ' is already started.';
    throw IllegalStateException_init_$Create$(toString(message));
  }
  // Inline function 'io.ktor.util.logging.trace' call
  var this_0 = get_LOGGER();
  if (get_isTraceEnabled(this_0)) {
    // Inline function 'io.ktor.websocket.DefaultWebSocketSessionImpl.start.<anonymous>' call
    var tmp$ret$0 = 'Starting default WebSocketSession(' + toString(this) + ') ' + ('with negotiated extensions: ' + joinToString(negotiatedExtensions));
    this_0.r2a(tmp$ret$0);
  }
  this.u2o_1.t(negotiatedExtensions);
  runOrCancelPinger(this);
  runIncomingProcessor(this, ponger(this, this.k2n()));
  runOutgoingProcessor(this);
};
protoOf(DefaultWebSocketSessionImpl).g1e = function ($completion) {
  return this.n2o_1.g1e($completion);
};
var properties_initialized_DefaultWebSocketSession_kt_6cjlhc;
function _init_properties_DefaultWebSocketSession_kt__469s0y() {
  if (!properties_initialized_DefaultWebSocketSession_kt_6cjlhc) {
    properties_initialized_DefaultWebSocketSession_kt_6cjlhc = true;
    LOGGER = KtorSimpleLogger('io.ktor.websocket.WebSocket');
    IncomingProcessorCoroutineName = new CoroutineName('ws-incoming-processor');
    OutgoingProcessorCoroutineName = new CoroutineName('ws-outgoing-processor');
    NORMAL_CLOSE = CloseReason_init_$Create$(Codes_NORMAL_getInstance(), 'OK');
  }
}
function NonDisposableHandle() {
}
protoOf(NonDisposableHandle).ko = function () {
  return Unit_instance;
};
protoOf(NonDisposableHandle).toString = function () {
  return 'NonDisposableHandle';
};
protoOf(NonDisposableHandle).hashCode = function () {
  return 207988788;
};
protoOf(NonDisposableHandle).equals = function (other) {
  if (this === other)
    return true;
  if (!(other instanceof NonDisposableHandle))
    return false;
  other instanceof NonDisposableHandle || THROW_CCE();
  return true;
};
var NonDisposableHandle_instance;
function NonDisposableHandle_getInstance() {
  return NonDisposableHandle_instance;
}
function readReason(_this__u8e3s4) {
  if (_this__u8e3s4.e2r_1.length < 2) {
    return null;
  }
  // Inline function 'io.ktor.utils.io.core.buildPacket' call
  var builder = new Buffer();
  // Inline function 'io.ktor.websocket.readReason.<anonymous>' call
  writeFully(builder, _this__u8e3s4.e2r_1);
  var packet = builder;
  var code = packet.v19();
  var message = readText(packet);
  return new CloseReason(code, message);
}
function FrameTooBigException(frameSize) {
  Exception_init_$Init$(this);
  captureStack(this, FrameTooBigException);
  this.o2s_1 = frameSize;
}
protoOf(FrameTooBigException).a9 = function () {
  return 'Frame is too big: ' + this.o2s_1.toString();
};
protoOf(FrameTooBigException).bs = function () {
  // Inline function 'kotlin.also' call
  var this_0 = new FrameTooBigException(this.o2s_1);
  // Inline function 'kotlin.contracts.contract' call
  // Inline function 'io.ktor.websocket.FrameTooBigException.createCopy.<anonymous>' call
  initCauseBridge(this_0, this);
  return this_0;
};
var FrameType_TEXT_instance;
var FrameType_BINARY_instance;
var FrameType_CLOSE_instance;
var FrameType_PING_instance;
var FrameType_PONG_instance;
function Companion_1() {
  Companion_instance_1 = this;
  var tmp = this;
  var tmp$ret$0;
  $l$block_0: {
    // Inline function 'kotlin.collections.maxByOrNull' call
    var iterator = get_entries_0().m();
    if (!iterator.n()) {
      tmp$ret$0 = null;
      break $l$block_0;
    }
    var maxElem = iterator.o();
    if (!iterator.n()) {
      tmp$ret$0 = maxElem;
      break $l$block_0;
    }
    // Inline function 'io.ktor.websocket.Companion.maxOpcode.<anonymous>' call
    var maxValue = maxElem.s2s_1;
    do {
      var e = iterator.o();
      // Inline function 'io.ktor.websocket.Companion.maxOpcode.<anonymous>' call
      var v = e.s2s_1;
      if (compareTo(maxValue, v) < 0) {
        maxElem = e;
        maxValue = v;
      }
    }
     while (iterator.n());
    tmp$ret$0 = maxElem;
  }
  tmp.t2s_1 = ensureNotNull(tmp$ret$0).s2s_1;
  var tmp_0 = this;
  var tmp_1 = 0;
  var tmp_2 = this.t2s_1 + 1 | 0;
  // Inline function 'kotlin.arrayOfNulls' call
  var tmp_3 = fillArrayVal(Array(tmp_2), null);
  while (tmp_1 < tmp_2) {
    var tmp_4 = tmp_1;
    var tmp$ret$5;
    $l$block_2: {
      // Inline function 'kotlin.collections.singleOrNull' call
      var single = null;
      var found = false;
      var tmp0_iterator = get_entries_0().m();
      while (tmp0_iterator.n()) {
        var element = tmp0_iterator.o();
        // Inline function 'io.ktor.websocket.Companion.byOpcodeArray.<anonymous>' call
        if (element.s2s_1 === tmp_4) {
          if (found) {
            tmp$ret$5 = null;
            break $l$block_2;
          }
          single = element;
          found = true;
        }
      }
      if (!found) {
        tmp$ret$5 = null;
        break $l$block_2;
      }
      tmp$ret$5 = single;
    }
    tmp_3[tmp_4] = tmp$ret$5;
    tmp_1 = tmp_1 + 1 | 0;
  }
  tmp_0.u2s_1 = tmp_3;
}
var Companion_instance_1;
function Companion_getInstance_1() {
  FrameType_initEntries();
  if (Companion_instance_1 == null)
    new Companion_1();
  return Companion_instance_1;
}
function values_0() {
  return [FrameType_TEXT_getInstance(), FrameType_BINARY_getInstance(), FrameType_CLOSE_getInstance(), FrameType_PING_getInstance(), FrameType_PONG_getInstance()];
}
function get_entries_0() {
  if ($ENTRIES_0 == null)
    $ENTRIES_0 = enumEntries(values_0());
  return $ENTRIES_0;
}
var FrameType_entriesInitialized;
function FrameType_initEntries() {
  if (FrameType_entriesInitialized)
    return Unit_instance;
  FrameType_entriesInitialized = true;
  FrameType_TEXT_instance = new FrameType('TEXT', 0, false, 1);
  FrameType_BINARY_instance = new FrameType('BINARY', 1, false, 2);
  FrameType_CLOSE_instance = new FrameType('CLOSE', 2, true, 8);
  FrameType_PING_instance = new FrameType('PING', 3, true, 9);
  FrameType_PONG_instance = new FrameType('PONG', 4, true, 10);
  Companion_getInstance_1();
}
var $ENTRIES_0;
function FrameType(name, ordinal, controlFrame, opcode) {
  Enum.call(this, name, ordinal);
  this.r2s_1 = controlFrame;
  this.s2s_1 = opcode;
}
function FrameType_TEXT_getInstance() {
  FrameType_initEntries();
  return FrameType_TEXT_instance;
}
function FrameType_BINARY_getInstance() {
  FrameType_initEntries();
  return FrameType_BINARY_instance;
}
function FrameType_CLOSE_getInstance() {
  FrameType_initEntries();
  return FrameType_CLOSE_instance;
}
function FrameType_PING_getInstance() {
  FrameType_initEntries();
  return FrameType_PING_instance;
}
function FrameType_PONG_getInstance() {
  FrameType_initEntries();
  return FrameType_PONG_instance;
}
function get_PongerCoroutineName() {
  _init_properties_PingPong_kt__9aqxey();
  return PongerCoroutineName;
}
var PongerCoroutineName;
function get_PingerCoroutineName() {
  _init_properties_PingPong_kt__9aqxey();
  return PingerCoroutineName;
}
var PingerCoroutineName;
function ponger(_this__u8e3s4, outgoing) {
  _init_properties_PingPong_kt__9aqxey();
  var channel = Channel(5);
  var tmp = get_PongerCoroutineName();
  launch(_this__u8e3s4, tmp, VOID, ponger$slambda_0(channel, outgoing, null));
  return channel;
}
function pinger(_this__u8e3s4, outgoing, periodMillis, timeoutMillis, onTimeout) {
  _init_properties_PingPong_kt__9aqxey();
  var actorJob = Job();
  var channel = Channel(2147483647);
  var tmp = actorJob.se(get_PingerCoroutineName());
  launch(_this__u8e3s4, tmp, VOID, pinger$slambda_0(periodMillis, timeoutMillis, onTimeout, channel, outgoing, null));
  var tmp_0 = ensureNotNull(_this__u8e3s4.xk().x8(Key_instance));
  tmp_0.zl(pinger$lambda(actorJob));
  return channel;
}
function ponger$slambda($channel, $outgoing, resultContinuation) {
  this.d2t_1 = $channel;
  this.e2t_1 = $outgoing;
  CoroutineImpl.call(this, resultContinuation);
}
protoOf(ponger$slambda).z1i = function ($this$launch, $completion) {
  var tmp = this.a1j($this$launch, $completion);
  tmp.m8_1 = Unit_instance;
  tmp.n8_1 = null;
  return tmp.s8();
};
protoOf(ponger$slambda).c9 = function (p1, $completion) {
  return this.z1i((!(p1 == null) ? isInterface(p1, CoroutineScope) : false) ? p1 : THROW_CCE(), $completion);
};
protoOf(ponger$slambda).s8 = function () {
  var suspendResult = this.m8_1;
  $sm: do
    try {
      var tmp = this.k8_1;
      switch (tmp) {
        case 0:
          this.l8_1 = 14;
          this.l8_1 = 13;
          var tmp_0 = this;
          tmp_0.g2t_1 = this.d2t_1;
          this.k8_1 = 1;
          continue $sm;
        case 1:
          var tmp_1 = this;
          tmp_1.i2t_1 = this.g2t_1;
          this.j2t_1 = null;
          this.k8_1 = 2;
          continue $sm;
        case 2:
          this.k8_1 = 3;
          continue $sm;
        case 3:
          this.l8_1 = 10;
          this.l8_1 = 9;
          var tmp_2 = this;
          tmp_2.l2t_1 = this.i2t_1;
          this.m2t_1 = this.l2t_1.m();
          this.k8_1 = 4;
          continue $sm;
        case 4:
          this.k8_1 = 5;
          suspendResult = this.m2t_1.e10(this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 5:
          if (!suspendResult) {
            this.k8_1 = 7;
            continue $sm;
          }

          this.n2t_1 = this.m2t_1.o();
          var tmp_3 = this;
          tmp_3.o2t_1 = this.n2t_1;
          get_LOGGER().r2a('Received ping message, sending pong message');
          this.k8_1 = 6;
          suspendResult = this.e2t_1.l12(new Pong(this.o2t_1.e2r_1), this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 6:
          this.k8_1 = 4;
          continue $sm;
        case 7:
          this.k2t_1 = Unit_instance;
          this.k8_1 = 8;
          var tmp_4 = this;
          continue $sm;
        case 8:
          this.l8_1 = 13;
          var tmp_5 = this;
          cancelConsumed(this.i2t_1, this.j2t_1);
          tmp_5.h2t_1 = Unit_instance;
          this.k8_1 = 12;
          continue $sm;
        case 9:
          this.l8_1 = 10;
          var tmp_6 = this.n8_1;
          if (tmp_6 instanceof Error) {
            var e = this.n8_1;
            var tmp_7 = this;
            this.j2t_1 = e;
            throw e;
          } else {
            throw this.n8_1;
          }

        case 10:
          this.l8_1 = 13;
          var t = this.n8_1;
          cancelConsumed(this.i2t_1, this.j2t_1);
          throw t;
        case 11:
          this.l8_1 = 13;
          cancelConsumed(this.i2t_1, this.j2t_1);
          if (false) {
            this.k8_1 = 1;
            continue $sm;
          }

          this.k8_1 = 12;
          continue $sm;
        case 12:
          this.l8_1 = 14;
          this.k8_1 = 15;
          continue $sm;
        case 13:
          this.l8_1 = 14;
          var tmp_8 = this.n8_1;
          if (tmp_8 instanceof ClosedSendChannelException) {
            var _unused_var__etf5q3 = this.n8_1;
            this.k8_1 = 15;
            continue $sm;
          } else {
            throw this.n8_1;
          }

        case 14:
          throw this.n8_1;
        case 15:
          this.l8_1 = 14;
          return Unit_instance;
      }
    } catch ($p) {
      var e_0 = $p;
      if (this.l8_1 === 14) {
        throw e_0;
      } else {
        this.k8_1 = this.l8_1;
        this.n8_1 = e_0;
      }
    }
   while (true);
};
protoOf(ponger$slambda).a1j = function ($this$launch, completion) {
  var i = new ponger$slambda(this.d2t_1, this.e2t_1, completion);
  i.f2t_1 = $this$launch;
  return i;
};
function ponger$slambda_0($channel, $outgoing, resultContinuation) {
  var i = new ponger$slambda($channel, $outgoing, resultContinuation);
  var l = function ($this$launch, $completion) {
    return i.z1i($this$launch, $completion);
  };
  l.$arity = 1;
  return l;
}
function pinger$slambda$slambda($channel, resultContinuation) {
  this.x2t_1 = $channel;
  CoroutineImpl.call(this, resultContinuation);
}
protoOf(pinger$slambda$slambda).z1i = function ($this$withTimeoutOrNull, $completion) {
  var tmp = this.a1j($this$withTimeoutOrNull, $completion);
  tmp.m8_1 = Unit_instance;
  tmp.n8_1 = null;
  return tmp.s8();
};
protoOf(pinger$slambda$slambda).c9 = function (p1, $completion) {
  return this.z1i((!(p1 == null) ? isInterface(p1, CoroutineScope) : false) ? p1 : THROW_CCE(), $completion);
};
protoOf(pinger$slambda$slambda).s8 = function () {
  var suspendResult = this.m8_1;
  $sm: do
    try {
      var tmp = this.k8_1;
      switch (tmp) {
        case 0:
          this.l8_1 = 3;
          this.k8_1 = 1;
          continue $sm;
        case 1:
          if (!true) {
            this.k8_1 = 4;
            continue $sm;
          }

          this.k8_1 = 2;
          suspendResult = this.x2t_1.p12(this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 2:
          this.k8_1 = 1;
          continue $sm;
        case 3:
          throw this.n8_1;
        case 4:
          return Unit_instance;
      }
    } catch ($p) {
      var e = $p;
      if (this.l8_1 === 3) {
        throw e;
      } else {
        this.k8_1 = this.l8_1;
        this.n8_1 = e;
      }
    }
   while (true);
};
protoOf(pinger$slambda$slambda).a1j = function ($this$withTimeoutOrNull, completion) {
  var i = new pinger$slambda$slambda(this.x2t_1, completion);
  i.y2t_1 = $this$withTimeoutOrNull;
  return i;
};
function pinger$slambda$slambda_0($channel, resultContinuation) {
  var i = new pinger$slambda$slambda($channel, resultContinuation);
  var l = function ($this$withTimeoutOrNull, $completion) {
    return i.z1i($this$withTimeoutOrNull, $completion);
  };
  l.$arity = 1;
  return l;
}
function pinger$slambda$slambda_1($outgoing, $pingMessage, $channel, resultContinuation) {
  this.h2u_1 = $outgoing;
  this.i2u_1 = $pingMessage;
  this.j2u_1 = $channel;
  CoroutineImpl.call(this, resultContinuation);
}
protoOf(pinger$slambda$slambda_1).z1i = function ($this$withTimeoutOrNull, $completion) {
  var tmp = this.a1j($this$withTimeoutOrNull, $completion);
  tmp.m8_1 = Unit_instance;
  tmp.n8_1 = null;
  return tmp.s8();
};
protoOf(pinger$slambda$slambda_1).c9 = function (p1, $completion) {
  return this.z1i((!(p1 == null) ? isInterface(p1, CoroutineScope) : false) ? p1 : THROW_CCE(), $completion);
};
protoOf(pinger$slambda$slambda_1).s8 = function () {
  var suspendResult = this.m8_1;
  $sm: do
    try {
      var tmp = this.k8_1;
      switch (tmp) {
        case 0:
          this.l8_1 = 6;
          get_LOGGER().r2a('WebSocket Pinger: sending ping frame');
          this.k8_1 = 1;
          suspendResult = this.h2u_1.l12(new Ping(toByteArray(this.i2u_1, Charsets_getInstance().e1j_1)), this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 1:
          this.k8_1 = 2;
          continue $sm;
        case 2:
          if (!true) {
            this.k8_1 = 5;
            continue $sm;
          }

          this.k8_1 = 3;
          suspendResult = this.j2u_1.p12(this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 3:
          var msg = suspendResult;
          if (decodeToString(msg.e2r_1, 0, 0 + msg.e2r_1.length | 0) === this.i2u_1) {
            get_LOGGER().r2a('WebSocket Pinger: received valid pong frame ' + msg.toString());
            this.k8_1 = 5;
            continue $sm;
          } else {
            this.k8_1 = 4;
            continue $sm;
          }

        case 4:
          get_LOGGER().r2a('WebSocket Pinger: received invalid pong frame ' + msg.toString() + ', continue waiting');
          this.k8_1 = 2;
          continue $sm;
        case 5:
          return Unit_instance;
        case 6:
          throw this.n8_1;
      }
    } catch ($p) {
      var e = $p;
      if (this.l8_1 === 6) {
        throw e;
      } else {
        this.k8_1 = this.l8_1;
        this.n8_1 = e;
      }
    }
   while (true);
};
protoOf(pinger$slambda$slambda_1).a1j = function ($this$withTimeoutOrNull, completion) {
  var i = new pinger$slambda$slambda_1(this.h2u_1, this.i2u_1, this.j2u_1, completion);
  i.k2u_1 = $this$withTimeoutOrNull;
  return i;
};
function pinger$slambda$slambda_2($outgoing, $pingMessage, $channel, resultContinuation) {
  var i = new pinger$slambda$slambda_1($outgoing, $pingMessage, $channel, resultContinuation);
  var l = function ($this$withTimeoutOrNull, $completion) {
    return i.z1i($this$withTimeoutOrNull, $completion);
  };
  l.$arity = 1;
  return l;
}
function pinger$slambda($periodMillis, $timeoutMillis, $onTimeout, $channel, $outgoing, resultContinuation) {
  this.t2u_1 = $periodMillis;
  this.u2u_1 = $timeoutMillis;
  this.v2u_1 = $onTimeout;
  this.w2u_1 = $channel;
  this.x2u_1 = $outgoing;
  CoroutineImpl.call(this, resultContinuation);
}
protoOf(pinger$slambda).z1i = function ($this$launch, $completion) {
  var tmp = this.a1j($this$launch, $completion);
  tmp.m8_1 = Unit_instance;
  tmp.n8_1 = null;
  return tmp.s8();
};
protoOf(pinger$slambda).c9 = function (p1, $completion) {
  return this.z1i((!(p1 == null) ? isInterface(p1, CoroutineScope) : false) ? p1 : THROW_CCE(), $completion);
};
protoOf(pinger$slambda).s8 = function () {
  var suspendResult = this.m8_1;
  $sm: do
    try {
      var tmp = this.k8_1;
      switch (tmp) {
        case 0:
          this.l8_1 = 9;
          get_LOGGER().r2a('Starting WebSocket pinger coroutine with period ' + this.t2u_1.toString() + ' ms and timeout ' + this.u2u_1.toString() + ' ms');
          this.z2u_1 = Random(getTimeMillis());
          this.a2v_1 = new Int8Array(32);
          this.l8_1 = 7;
          this.k8_1 = 1;
          continue $sm;
        case 1:
          if (!true) {
            this.k8_1 = 6;
            continue $sm;
          }

          this.k8_1 = 2;
          suspendResult = withTimeoutOrNull(this.t2u_1, pinger$slambda$slambda_0(this.w2u_1, null), this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 2:
          this.z2u_1.bf(this.a2v_1);
          this.b2v_1 = '[ping ' + hex(this.a2v_1) + ' ping]';
          this.k8_1 = 3;
          suspendResult = withTimeoutOrNull(this.u2u_1, pinger$slambda$slambda_2(this.x2u_1, this.b2v_1, this.w2u_1, null), this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 3:
          this.c2v_1 = suspendResult;
          if (this.c2v_1 == null) {
            get_LOGGER().r2a('WebSocket pinger has timed out');
            this.k8_1 = 5;
            suspendResult = this.v2u_1(CloseReason_init_$Create$(Codes_INTERNAL_ERROR_getInstance(), 'Ping timeout'), this);
            if (suspendResult === get_COROUTINE_SUSPENDED()) {
              return suspendResult;
            }
            continue $sm;
          } else {
            this.k8_1 = 4;
            continue $sm;
          }

        case 4:
          this.k8_1 = 1;
          continue $sm;
        case 5:
          this.k8_1 = 6;
          continue $sm;
        case 6:
          this.l8_1 = 9;
          this.k8_1 = 8;
          continue $sm;
        case 7:
          this.l8_1 = 9;
          var tmp_0 = this.n8_1;
          if (tmp_0 instanceof CancellationException) {
            var ignore = this.n8_1;
            this.k8_1 = 8;
            continue $sm;
          } else {
            var tmp_1 = this.n8_1;
            if (tmp_1 instanceof ClosedReceiveChannelException) {
              var ignore_0 = this.n8_1;
              this.k8_1 = 8;
              continue $sm;
            } else {
              var tmp_2 = this.n8_1;
              if (tmp_2 instanceof ClosedSendChannelException) {
                var ignore_1 = this.n8_1;
                this.k8_1 = 8;
                continue $sm;
              } else {
                throw this.n8_1;
              }
            }
          }

        case 8:
          this.l8_1 = 9;
          return Unit_instance;
        case 9:
          throw this.n8_1;
      }
    } catch ($p) {
      var e = $p;
      if (this.l8_1 === 9) {
        throw e;
      } else {
        this.k8_1 = this.l8_1;
        this.n8_1 = e;
      }
    }
   while (true);
};
protoOf(pinger$slambda).a1j = function ($this$launch, completion) {
  var i = new pinger$slambda(this.t2u_1, this.u2u_1, this.v2u_1, this.w2u_1, this.x2u_1, completion);
  i.y2u_1 = $this$launch;
  return i;
};
function pinger$slambda_0($periodMillis, $timeoutMillis, $onTimeout, $channel, $outgoing, resultContinuation) {
  var i = new pinger$slambda($periodMillis, $timeoutMillis, $onTimeout, $channel, $outgoing, resultContinuation);
  var l = function ($this$launch, $completion) {
    return i.z1i($this$launch, $completion);
  };
  l.$arity = 1;
  return l;
}
function pinger$lambda($actorJob) {
  return function (it) {
    $actorJob.gm();
    return Unit_instance;
  };
}
var properties_initialized_PingPong_kt_fbfhmc;
function _init_properties_PingPong_kt__9aqxey() {
  if (!properties_initialized_PingPong_kt_fbfhmc) {
    properties_initialized_PingPong_kt_fbfhmc = true;
    PongerCoroutineName = new CoroutineName('ws-ponger');
    PingerCoroutineName = new CoroutineName('ws-pinger');
  }
}
function WebSocketExtension() {
}
function WebSocketExtensionsConfig() {
  var tmp = this;
  // Inline function 'kotlin.collections.mutableListOf' call
  tmp.f2v_1 = ArrayList_init_$Create$();
  var tmp_0 = this;
  // Inline function 'kotlin.arrayOf' call
  // Inline function 'kotlin.js.unsafeCast' call
  // Inline function 'kotlin.js.asDynamic' call
  tmp_0.g2v_1 = [false, false, false];
}
protoOf(WebSocketExtensionsConfig).r2c = function () {
  // Inline function 'kotlin.collections.map' call
  var this_0 = this.f2v_1;
  // Inline function 'kotlin.collections.mapTo' call
  var destination = ArrayList_init_$Create$_0(collectionSizeOrDefault(this_0, 10));
  var tmp0_iterator = this_0.m();
  while (tmp0_iterator.n()) {
    var item = tmp0_iterator.o();
    // Inline function 'io.ktor.websocket.WebSocketExtensionsConfig.build.<anonymous>' call
    var tmp$ret$0 = item();
    destination.k(tmp$ret$0);
  }
  return destination;
};
function parametersToString($this) {
  return $this.i2v_1.h() ? '' : ', ' + joinToString($this.i2v_1, ',');
}
function WebSocketExtensionHeader(name, parameters) {
  this.h2v_1 = name;
  this.i2v_1 = parameters;
}
protoOf(WebSocketExtensionHeader).toString = function () {
  return this.h2v_1 + ' ' + parametersToString(this);
};
function parseWebSocketExtensions(value) {
  // Inline function 'kotlin.collections.map' call
  var this_0 = split(value, [',']);
  // Inline function 'kotlin.collections.mapTo' call
  var destination = ArrayList_init_$Create$_0(collectionSizeOrDefault(this_0, 10));
  var tmp0_iterator = this_0.m();
  while (tmp0_iterator.n()) {
    var item = tmp0_iterator.o();
    // Inline function 'io.ktor.websocket.parseWebSocketExtensions.<anonymous>' call
    var extension = split(item, [';']);
    // Inline function 'kotlin.text.trim' call
    var this_1 = first(extension);
    var name = toString(trim(isCharSequence(this_1) ? this_1 : THROW_CCE()));
    // Inline function 'kotlin.collections.map' call
    var this_2 = drop(extension, 1);
    // Inline function 'kotlin.collections.mapTo' call
    var destination_0 = ArrayList_init_$Create$_0(collectionSizeOrDefault(this_2, 10));
    var tmp0_iterator_0 = this_2.m();
    while (tmp0_iterator_0.n()) {
      var item_0 = tmp0_iterator_0.o();
      // Inline function 'io.ktor.websocket.parseWebSocketExtensions.<anonymous>.<anonymous>' call
      // Inline function 'kotlin.text.trim' call
      var tmp$ret$2 = toString(trim(isCharSequence(item_0) ? item_0 : THROW_CCE()));
      destination_0.k(tmp$ret$2);
    }
    var parameters = destination_0;
    var tmp$ret$5 = new WebSocketExtensionHeader(name, parameters);
    destination.k(tmp$ret$5);
  }
  return destination;
}
function WebSocketSession() {
}
function close(_this__u8e3s4, reason, $completion) {
  reason = reason === VOID ? CloseReason_init_$Create$(Codes_NORMAL_getInstance(), '') : reason;
  var tmp = new $closeCOROUTINE$3(_this__u8e3s4, reason, $completion);
  tmp.m8_1 = Unit_instance;
  tmp.n8_1 = null;
  return tmp.s8();
}
function closeExceptionally(_this__u8e3s4, cause, $completion) {
  var tmp;
  if (cause instanceof CancellationException) {
    tmp = CloseReason_init_$Create$(Codes_NORMAL_getInstance(), '');
  } else {
    tmp = CloseReason_init_$Create$(Codes_INTERNAL_ERROR_getInstance(), cause.toString());
  }
  var reason = tmp;
  return close(_this__u8e3s4, reason, $completion);
}
function $closeCOROUTINE$3(_this__u8e3s4, reason, resultContinuation) {
  CoroutineImpl.call(this, resultContinuation);
  this.r2v_1 = _this__u8e3s4;
  this.s2v_1 = reason;
}
protoOf($closeCOROUTINE$3).s8 = function () {
  var suspendResult = this.m8_1;
  $sm: do
    try {
      var tmp = this.k8_1;
      switch (tmp) {
        case 0:
          this.l8_1 = 4;
          this.l8_1 = 3;
          this.k8_1 = 1;
          suspendResult = this.r2v_1.l2n(Close_init_$Create$(this.s2v_1), this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 1:
          this.k8_1 = 2;
          suspendResult = this.r2v_1.g1e(this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 2:
          this.l8_1 = 4;
          this.k8_1 = 5;
          continue $sm;
        case 3:
          this.l8_1 = 4;
          var tmp_0 = this.n8_1;
          if (tmp_0 instanceof Error) {
            var _unused_var__etf5q3 = this.n8_1;
            this.k8_1 = 5;
            continue $sm;
          } else {
            throw this.n8_1;
          }

        case 4:
          throw this.n8_1;
        case 5:
          this.l8_1 = 4;
          return Unit_instance;
      }
    } catch ($p) {
      var e = $p;
      if (this.l8_1 === 4) {
        throw e;
      } else {
        this.k8_1 = this.l8_1;
        this.n8_1 = e;
      }
    }
   while (true);
};
function Binary_init_$Init$(fin, data, $this) {
  Binary.call($this, fin, data, false, false, false);
  return $this;
}
function Binary_init_$Create$(fin, data) {
  return Binary_init_$Init$(fin, data, objectCreate(protoOf(Binary)));
}
function Text_init_$Init$(fin, data, $this) {
  Text.call($this, fin, data, false, false, false);
  return $this;
}
function Text_init_$Init$_0(text, $this) {
  Text_init_$Init$(true, toByteArray(text), $this);
  return $this;
}
function Text_init_$Create$(text) {
  return Text_init_$Init$_0(text, objectCreate(protoOf(Text)));
}
function Close_init_$Init$(reason, $this) {
  // Inline function 'io.ktor.utils.io.core.buildPacket' call
  var builder = new Buffer();
  // Inline function 'io.ktor.websocket.Close.<init>.<anonymous>' call
  builder.b1b(reason.d2n_1);
  writeText(builder, reason.e2n_1);
  Close_init_$Init$_0(builder, $this);
  return $this;
}
function Close_init_$Create$(reason) {
  return Close_init_$Init$(reason, objectCreate(protoOf(Close)));
}
function Close_init_$Init$_0(packet, $this) {
  Close.call($this, readByteArray(packet));
  return $this;
}
function Close_init_$Init$_1($this) {
  Close.call($this, Companion_getInstance_2().j2r_1);
  return $this;
}
function Close_init_$Create$_0() {
  return Close_init_$Init$_1(objectCreate(protoOf(Close)));
}
function Binary(fin, data, rsv1, rsv2, rsv3) {
  rsv1 = rsv1 === VOID ? false : rsv1;
  rsv2 = rsv2 === VOID ? false : rsv2;
  rsv3 = rsv3 === VOID ? false : rsv3;
  Frame.call(this, fin, FrameType_BINARY_getInstance(), data, NonDisposableHandle_instance, rsv1, rsv2, rsv3);
}
function Text(fin, data, rsv1, rsv2, rsv3) {
  rsv1 = rsv1 === VOID ? false : rsv1;
  rsv2 = rsv2 === VOID ? false : rsv2;
  rsv3 = rsv3 === VOID ? false : rsv3;
  Frame.call(this, fin, FrameType_TEXT_getInstance(), data, NonDisposableHandle_instance, rsv1, rsv2, rsv3);
}
function Close(data) {
  Frame.call(this, true, FrameType_CLOSE_getInstance(), data, NonDisposableHandle_instance, false, false, false);
}
function Ping(data) {
  Frame.call(this, true, FrameType_PING_getInstance(), data, NonDisposableHandle_instance, false, false, false);
}
function Pong(data, disposableHandle) {
  disposableHandle = disposableHandle === VOID ? NonDisposableHandle_instance : disposableHandle;
  Frame.call(this, true, FrameType_PONG_getInstance(), data, disposableHandle, false, false, false);
}
function Companion_2() {
  Companion_instance_2 = this;
  this.j2r_1 = new Int8Array(0);
}
protoOf(Companion_2).k2r = function (fin, frameType, data, rsv1, rsv2, rsv3) {
  var tmp;
  switch (frameType.n2_1) {
    case 1:
      tmp = new Binary(fin, data, rsv1, rsv2, rsv3);
      break;
    case 0:
      tmp = new Text(fin, data, rsv1, rsv2, rsv3);
      break;
    case 2:
      tmp = new Close(data);
      break;
    case 3:
      tmp = new Ping(data);
      break;
    case 4:
      tmp = new Pong(data, NonDisposableHandle_instance);
      break;
    default:
      noWhenBranchMatchedException();
      break;
  }
  return tmp;
};
var Companion_instance_2;
function Companion_getInstance_2() {
  if (Companion_instance_2 == null)
    new Companion_2();
  return Companion_instance_2;
}
function Frame(fin, frameType, data, disposableHandle, rsv1, rsv2, rsv3) {
  Companion_getInstance_2();
  disposableHandle = disposableHandle === VOID ? NonDisposableHandle_instance : disposableHandle;
  rsv1 = rsv1 === VOID ? false : rsv1;
  rsv2 = rsv2 === VOID ? false : rsv2;
  rsv3 = rsv3 === VOID ? false : rsv3;
  this.c2r_1 = fin;
  this.d2r_1 = frameType;
  this.e2r_1 = data;
  this.f2r_1 = disposableHandle;
  this.g2r_1 = rsv1;
  this.h2r_1 = rsv2;
  this.i2r_1 = rsv3;
}
protoOf(Frame).toString = function () {
  return 'Frame ' + this.d2r_1.toString() + ' (fin=' + this.c2r_1 + ', buffer len = ' + this.e2r_1.length + ')';
};
function get_OUTGOING_CHANNEL_CAPACITY() {
  return 8;
}
//region block: post-declaration
protoOf(DefaultWebSocketSessionImpl).l2n = send;
defineProp(protoOf(FrameTooBigException), 'message', function () {
  return this.a9();
});
//endregion
//region block: init
NonDisposableHandle_instance = new NonDisposableHandle();
//endregion
//region block: exports
export {
  Codes_CLOSED_ABNORMALLY_getInstance as Codes_CLOSED_ABNORMALLY_getInstance1bzb878jpjbg8,
  Codes_NORMAL_getInstance as Codes_NORMAL_getInstance3dr9ood98owg7,
  send as send1mbirylegmq1f,
  Binary_init_$Create$ as Binary_init_$Create$1c9bipx4oyri7,
  Close_init_$Create$ as Close_init_$Create$1s9krjd24ykq6,
  Text_init_$Create$ as Text_init_$Create$dnevgba6vdmn,
  Companion_getInstance as Companion_getInstance200rusngf19yu,
  CloseReason as CloseReason10cphaqpp3ct7,
  DefaultWebSocketSession_0 as DefaultWebSocketSession2pi4wuih6mkcj,
  DefaultWebSocketSession as DefaultWebSocketSession3h8506yqzs5fx,
  WebSocketExtensionsConfig as WebSocketExtensionsConfig3sf1f7u7xi63m,
  WebSocketExtension as WebSocketExtensionixqq2y77p4e0,
  WebSocketSession as WebSocketSessionzi1ianvyj32u,
  parseWebSocketExtensions as parseWebSocketExtensionszyo25w86ylog,
};
//endregion

//# sourceMappingURL=ktor-ktor-shared-ktor-websockets.mjs.map
